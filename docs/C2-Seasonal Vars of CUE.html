<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>c2-seasonal-vars-of-cue – Zoe PhD Info</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-52109d51d0c4eda6f299237d1ec06587.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Zoe PhD Info</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./C1-Partitioning Algorithms.html"> 
<span class="menu-text">C1-Partitioning Algorithms</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./C2-Seasonal Vars of CUE.html" aria-current="page"> 
<span class="menu-text">C2-Seasonal Vars of CUE</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./C3-Coordination of MCUE VCUE.html"> 
<span class="menu-text">C3-Coordination of MCUE VCUE</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./EC_basic.html"> 
<span class="menu-text">EC Basic</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./CUE.html"> 
<span class="menu-text">CUE Review</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/ZoeZHH" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#chapter-2-understanding-seasonal-variations-of-carbon-use-efficiency-and-autotrophic-respiration-using-eddy-covariance-observations" id="toc-chapter-2-understanding-seasonal-variations-of-carbon-use-efficiency-and-autotrophic-respiration-using-eddy-covariance-observations" class="nav-link active" data-scroll-target="#chapter-2-understanding-seasonal-variations-of-carbon-use-efficiency-and-autotrophic-respiration-using-eddy-covariance-observations"><strong>CHAPTER 2-Understanding Seasonal Variations of Carbon Use Efficiency and Autotrophic Respiration Using Eddy Covariance Observations</strong></a>
  <ul class="collapse">
  <li><a href="#related-papers" id="toc-related-papers" class="nav-link" data-scroll-target="#related-papers"><strong>Related Papers</strong></a>
  <ul class="collapse">
  <li><a href="#findings" id="toc-findings" class="nav-link" data-scroll-target="#findings">Findings</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#specific-studies" id="toc-specific-studies" class="nav-link" data-scroll-target="#specific-studies">Specific Studies</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="chapter-2-understanding-seasonal-variations-of-carbon-use-efficiency-and-autotrophic-respiration-using-eddy-covariance-observations" class="level1">
<h1><strong>CHAPTER 2-Understanding Seasonal Variations of Carbon Use Efficiency and Autotrophic Respiration Using Eddy Covariance Observations</strong></h1>
<p><strong>Overview:</strong> Carbon use efficiency (CUE), defined as the ratio of net primary production (NPP, where NPP = GPP − R<sub>a</sub>) to gross primary production (GPP), is a key indicator of how efficiently ecosystems convert assimilated carbon into biomass. Due to the challenges of directly measuring NPP, CUE has often been assumed to be nearly constant across ecosystems over the past two decades. As a result, little attention has been given to its seasonal or temporal variability. However, a recent study has introduced new methods to estimate NPP and autotrophic respiration (R<sub>a</sub>) by using ecosystem respiration (R<sub>eco</sub>) and GPP derived from eddy covariance (EC) data. These approaches suggest that CUE can vary significantly among ecosystems and over time. In this study, I apply this novel method using the refined GPP and R<sub>eco</sub> data from previous chapter to investigate the seasonal dynamics of both CUE and R<sub>a</sub>.</p>
<section id="related-papers" class="level2">
<h2 class="anchored" data-anchor-id="related-papers"><strong>Related Papers</strong></h2>
<p>Shifts in plant respiration and carbon use efficiency at a large-scale drought experiment in the eastern Amazon (Metcalfe et al., 2010)</p>
<p>Research gap and question: The effects of drought upon ecosystem structure and function in the Amazon are potentially large but remain poorly defined.-&gt; A range of studies from drought experiments in the Amazon have examined numerous C cycle components in isolation, but none have yet synthesized these individual components to construct a full C budget of a droughted Amazon forest. In this study, to examine the impacts of a large-scale through-fall exclusion (TFE) treatment in an eastern Amazon primary rainforest on ecosystem C cycling and partitioning.</p>
<p>Related Concepts: Plant Carbon Expenditure (PCE), total C plants use for processes like respiration and growth: PCE = NPP + Ra Gross primary productivity (GPP) is the total quantity of C entering the forest via photosynthesis GPP ~ PCE ~ Reco under steady-state conditions NTP (net change in tree C balance) = PCE - GPP NTP tells us whether trees are gaining C (NTP &lt; 0), losing C (NTP &gt; 0) or in balance (NTP ~ 0)</p>
<p>Methods: 1 ha plot (TFE plot) was modified by the installation of plastic panels placed at 1–2 m above the ground,</p>
<p>Carbon Component How It Was Quantified (Key Method + Instrument) Canopy NPP: Monthly litterfall traps; LAI from hemispherical photos; LMA from harvested leaves. Stem &amp; branch NPP: Annual DBH measurements; biomass from allometric equations; branch fall from transects. Fine root NPP: Soil cores (0–30 cm); roots washed, dried, weighed. Coarse root NPP: Deep soil pits (to 3 m); biomass scaled using depth/diameter ratios. DOC export: Literature value from Amazon catchment study. VOC / CH₄ emissions: Literature-based estimate (no field measurements). Leaf respiration: Leaf gas exchange using portable IRGA chambers (dark respiration). Stem respiration: Literature respiration rates scaled by stem surface area. Soil respiration: Closed dynamic chambers + IRGA; monthly CO₂ efflux at 25 points per plot. Dead wood respiration: Chamber-based CO₂ efflux measurements on woody debris pieces.</p>
<p>Main Findings:</p>
<p><strong>ABOUT CUE</strong></p>
<p>Greater Reco in the TFE plot was mainly attributable to the higher Rauto flux of 25.8 ± 3.4 t C ha)1 yr)1 compared with 22.4 ± 2.8 t C ha-1 yr-1 in the control</p>
<p>Total estimated NPP was 2.4 ± 1.4 t C ha-1 yr-1 lower on the TFE plot relative to the control (Table 2, Fig. 3a).</p>
<p><strong>CUE = NPP/Ra+NPP, with precipitation, Ra increases, NPP decreases, Ra increases bigger than NPP decreases, denominator larger CUE decreases</strong></p>
<p>The TFE treatment was associated with a lower CUE in all plant organs, but particularly canopy CUE (control, 0.41 ± 0.07; TFE, 0.30 ± 0.07). The overall effect was a lower ecosystem CUE in the TFE plot of 0.24 ± 0.04 compared with 0.32 ± 0.04 in the control plot (Table 2, Fig. 4).</p>
<p>Drought reduced carbon allocation to roots and/or increased root mortality, leading to lower below-ground biomass.</p>
<section id="findings" class="level3">
<h3 class="anchored" data-anchor-id="findings">Findings</h3>
<p>Through analysing 26 papers, 60 data points to reject the hypothesis: CUE is constant among forest types.</p>
<p>DeLUCIA, E. H., Drake, J. E., Thomas, R. B., &amp; Gonzalez‐Meler, M. (2007). Forest carbon use efficiency: Is respiration a constant fraction of gross primary production? Global Change Biology, 13(6), 1157–1167. https://doi.org/10.1111/j.1365-2486.2007.01365.x</p>
</section>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p><em>Doughty, C. E., Goldsmith, G. R., Raab, N., Girardin, C. A. J., Amezquita, F. F., Huaraca‑Huasco, W. H., Silva‑Espejo, J. E., Araujo‑Murakami, A., da Costa, M. C., da Costa, A. C. L., Rocha, W., Galbraith, D., Meir, P., Metcalfe, D. B., &amp; Malhi, Y. (2018). What controls variation in carbon use efficiency among Amazonian tropical forests?</em> <em>Biotropica, 50</em>(1), 16–25. <a href="https://doi.org/10.1111/btp.12504" class="uri">https://doi.org/10.1111/btp.12504</a></p>
<p>Malhi, Y., Girardin, C., Metcalfe, D. B., Doughty, C. E., Aragão, L. E. O. C., Rifai, S. W., Oliveras, I., Shenkin, A., Aguirre‑Gutiérrez, J., Dahlsjö, C. A. L., Riutta, T., Berenguer, E., Moore, S., Huasco, W. H., Salinas, N., da Costa, A. C. L., Bentley, L. P., Adu‑Bredu, S., Marthews, T. R., … Phillips, O. L. (2021). The Global Ecosystems Monitoring network: Monitoring ecosystem productivity and carbon cycling across the tropics. <em>Biological Conservation, 253</em>, Article 108889. <a href="https://doi.org/10.1016/j.biocon.2020.108889" class="uri">https://doi.org/10.1016/j.biocon.2020.108889</a></p>
<p>Lu, X., Chung, C., Malhi, Y., &amp; Huang, C. (2025). Global patterns in the allocation of forest net primary production. <em>Journal of Biogeography</em>, <em>––</em> (Advance online publication). <a href="https://doi.org/10.1111/jbi.15094" class="uri">https://doi.org/10.1111/jbi.15094</a> <a href="https://www.climate.ox.ac.uk/publication/2082102/dimensions?utm_source=chatgpt.com" alt="https://www.climate.ox.ac.uk/publication/2082102/dimensions?utm_source=chatgpt.com"><u>Lund University+10climate.ox.ac.uk+10onesearch.nihlibrary.ors.nih.gov+10</u></a></p>
</section>
<section id="specific-studies" class="level3">
<h3 class="anchored" data-anchor-id="specific-studies">Specific Studies</h3>
<p><strong>Two 1 ha plots (drainage shallow soils vs.&nbsp;humid amazonian forests) in Amazon forest in Bolivia (Araujo-Murakami et al., 2013) - Southern Amazonian Forests</strong></p>
<p>Tropical forests with CUE near 0.3, which is lower than temperate forests 0.5 as 1) old-growth systems and a higher CUE is associated with recovery from disturbance or systems are naturally more dynamics<br>
<br>
Southern Amazon: dry, less studied<br>
Central and eastern: more humid, most large-scale C cycling measurements have taken place<br>
NPP in tropical forests: allocation patterns were fairly consistent across sites, little variance in canopy allocation but shifting allocation between fine roots and woody tissue NPP<br>
<br>
Differences between long-term and short-term disturbances:<br>
Long-term drought (Metcalfe et a., 2010): lower CUE<br>
Single disturbance event (Malhi et al., 2009): increase CUE as more C is allocated to biomass production during recovery phase</p>
<p>Research Qs: 1) how do seasonal cycles of components of Ra and NPP vary between two plots? 2) what is total budget of NPP and respiration, and how does this budget varies between humid and more xeric plot? 3) Do C allocation patterns and CUE differ between humid and dry plots?<br>
<br>
Site Specifics:<br>
- relatively high fertility<br>
- low acidity<br>
- Two plots (Kenia-wet, Kenia-dry)<br>
Kenia-wet: deeper soils, large trees, typical Amazon biome<br>
Kenia-dry: higher wood density, thorny branches, small leaves, humid amazon forest zone</p>
<p>Results:<br>
<strong>Peak</strong> of rainy season: December to February<br>
Dry season (less than 100 mm rainfall yr-1): April to September<br>
coldest temperatures (as austral winter): May-July<br>
<br>
1) Fine root NPP: Kenia-<strong>wet</strong> had significantly more total fine root NPP than Kenia-dry<br>
2) Aboveground woody NPP: kenia-<strong>dry</strong> is higher<br>
3) Canopy-NPP (total litterfall): Kenia-dry vs <strong>wet</strong> during dry (0.30 vs.&nbsp;0.66)<br>
4) Branch turnover NPP: overall similar (wet&gt;dry a bit?), strong seasonal cycle<br>
5) Ra (Rleaves, Rstems, Rrhizo) lower over the dry seasons<br>
6) Woody respiration was significantly greater at Kenia-wet (P &lt; 0.05)<br>
7) Kenia-dry had lower LAI and lower average leaf photosynthesis than Kenia-wet (The abundant drought-deciduous trees in Kenia-dry lost most of their leaves in the dry season)<br>
8）NPP higher at wet compared to dry (15.50 ± 0.89 vs.&nbsp;11.27 ± 0.68), Ra higher at wet compared to dry (18.64 ± 2.78 vs.&nbsp;15.61 ± 2.61)；CUE 0.45 ± 0.05 at Kenia-wet vs.&nbsp;0.42 ± 0.05 at Kenia-dry</p>
<p>Hints: Decreased in precipitation with decreased in solar radiation-&gt;further decrease photosynthesis<br>
The evergreen Kenia-wet plot displays strong seasonality in leaf flush with a bimodal peak in March and October, new leaves are flushing to coincide with the peaks in radiation, this has similarities to sites in the eastern Amazon, where leaf flush tends to correspond with the dry season, with highest sunlight.</p>
<p><strong>First study in western Amazonia, 2 1 ha plots in south-eastern Peru (CUE = NPP/PCE)</strong></p>
<p>Research Qs:</p>
<ol type="1">
<li>How do the components of NPP vary over the seasonal cycle in these two plots, and how do they relate to climate conditions?</li>
<li>How do the components of autotrophic and heterotrophic respiration vary over the seasonal cycle in these two plots, and how do they relate to climate conditions?</li>
<li>How does the total cycle of carbon production, carbon-use efficiency (the ratio of NPP to GPP) and NPP allocation differ between the plots, and compare with previously published results from Brazilian Amazonia?</li>
</ol>
<p>- higher wood productivity, turnover and different species composition and lower wood density compared to eastern Amazonian forests</p>
<p>Study Sites:<br>
TAM-05 VS. TAM-06<br>
Peak of the rainy season: December to February<br>
Dry season (&lt;100mm/month): May-September<br>
Solar radiation: late dry, early wet season, August-November<br>
SWC: TAM-05 21.8% (more sand) Vs. TAM-06 35.5%</p>
<p>Main Findings:<br>
- Leaf fall rise in mid-dry season, peaking at the end of the dry season<br>
- Fine root growth showed substantial seasonality in phase with the rainfall pattern, peak in peak wet season, a minimum in dry season<br>
- 15.0 ± 0.8 Mg C ha−1 year−1 /14.2 ± 1.0 Mg C ha−1 year−1 (TAM05/TAM06)<br>
- 0.42 ± 0.05/0.41 ± 0.05<br>
- NPP show seasonal variations, lower over dry and higher over wet<br>
- Ra no significant seasonality in both sites, TAM06 not significant but Ra lower over dry (when Ra decreases smaller than NPP, suggests CUE decreases)<br>
- CUE is highest in the wet season (October–March), being 0.37 ± 0.06/0.44 ± 0.09 in TAM-05/06, and reaches its lowest values in the wet–dry transition (April–June), being 0.29 ± 0.08/0.27 ± 0.08.<br>
<br>
Hints: In this study, assume BP is close to total actual NPP, and retain the terminology NPP for the sum of the biomass production components, and carbon use efficiency (CUE) for the ratio NPP/GPP.</p>
<p>Plant Carbon Expenditure (PCE) is approximated to GPP from a long term perspective but may not be equivalent to GPP if there is a substantial seasonal cycle of storage of non-structural carbohydrates (e.g.&nbsp;if products of “excess” GPP are stored in one season and allocated to NPP or metabolism in another season)<br>
<br>
On a seasonal timescale, we distinguish PCE from GPP, significant seasonal storage of C in the form of NSCs. NSC accumulation in dry season and depletion in wet season</p>
<p><strong>Evidence for strong seasonality in the carbon storage and carbon use efficiency of an Amazonian forest</strong></p>
<p><strong>NPP/CUE in a temperate apple orchard</strong></p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2023, Hehan (Zoe) Zhang</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>